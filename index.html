<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>點餐系統 (修復版)</title>
    <!-- 引入 React 與 Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 引入 Babel 用來解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        // =================================================================
        // 1. Firebase 核心模組引入 (版本統一為 10.12.2)
        // =================================================================
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        
        // 補上了 signInAnonymously 避免報錯
        import { getAuth, GoogleAuthProvider, signInWithPopup, signInAnonymously, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, where, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // =================================================================
        // 2. Firebase 設定檔 (已從您的截圖中還原)
        // =================================================================
        const firebaseConfig = {
       apiKey: "AIzaSyDYu_gtcp25wx4S25LubmWSQGRgxLrppy0",
  authDomain: "popo-ordering.firebaseapp.com",
  projectId: "popo-ordering",
  storageBucket: "popo-ordering.firebasestorage.app",
  messagingSenderId: "44845700960",
  appId: "1:44845700960:web:b6fd95203d627cacb67005"
        };

        // =================================================================
        // 3. 初始化 Firebase
        // =================================================================
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        console.log("Firebase 連線成功！");

        // =================================================================
        // 4. React 應用程式區塊
        // (確認修復成功後，請將您原本的點餐系統程式碼貼回這裡覆蓋 App 元件)
        // =================================================================
        function App() {
            const [user, setUser] = React.useState(null);
            const [loading, setLoading] = React.useState(true);
            const [errorMsg, setErrorMsg] = React.useState("");

            // 監聽登入狀態
            React.useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
                    setUser(currentUser);
                    setLoading(false);
                }, (error) => {
                    console.error("Auth Error:", error);
                    setErrorMsg(error.message);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            // Google 登入功能
            const handleGoogleLogin = async () => {
                try {
                    const provider = new GoogleAuthProvider();
                    await signInWithPopup(auth, provider);
                } catch (error) {
                    console.error("登入失敗", error);
                    alert("登入失敗: " + error.message);
                }
            };

            // 匿名登入功能 (備用)
            const handleAnonymousLogin = async () => {
                try {
                    await signInAnonymously(auth);
                } catch (error) {
                    console.error("匿名登入失敗", error);
                    alert("匿名登入失敗: " + error.message);
                }
            };

            if (loading) return <div className="p-10 text-center">系統載入中...</div>;

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4">
                    <div className="bg-white p-8 rounded-lg shadow-xl max-w-md w-full text-center">
                        <div className="mb-6">
                            <div className="w-16 h-16 bg-green-100 text-green-500 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">
                                ✓
                            </div>
                            <h1 className="text-2xl font-bold text-gray-800">系統修復成功</h1>
                            <p className="text-gray-500 mt-2">Firebase 設定檔與引用路徑已修正</p>
                        </div>

                        {errorMsg && (
                            <div className="bg-red-100 text-red-700 p-3 rounded mb-4 text-sm text-left">
                                錯誤: {errorMsg}
                            </div>
                        )}

                        <div className="border-t pt-6">
                            {user ? (
                                <div>
                                    <p className="mb-4 font-medium text-lg">
                                        嗨，{user.displayName || "匿名使用者"}！
                                    </p>
                                    <p className="text-sm text-gray-400 mb-6">UID: {user.uid}</p>
                                    <button 
                                        onClick={() => signOut(auth)}
                                        className="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded transition"
                                    >
                                        登出測試
                                    </button>
                                </div>
                            ) : (
                                <div className="space-y-3">
                                    <button 
                                        onClick={handleGoogleLogin}
                                        className="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition flex items-center justify-center gap-2"
                                    >
                                        測試 Google 登入
                                    </button>
                                    <button 
                                        onClick={handleAnonymousLogin}
                                        className="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded transition"
                                    >
                                        測試匿名登入
                                    </button>
                                </div>
                            )}
                        </div>
                        
                        <div className="mt-8 text-xs text-gray-400 bg-gray-50 p-3 rounded text-left">
                            <p className="font-bold mb-1">下一步：</p>
                            <p>確認登入按鈕可以按之後，請將原本的 <code>function App() ...</code> 程式碼貼回來覆蓋掉目前的測試畫面。</p>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

